<?xml version="1.0"?>
<root main_tree_to_execute="BehaviorTree">
    <!-- ////////// -->
    <BehaviorTree ID="BehaviorTree">
        <Fallback>
            <Sequence>
                <IsFirstRunCondition ID="isFirstRun" first_run_flag="${first_run_flag}"/>
                <FindHumanAction ID="findHuman" current_id="${current_id}" first_run_set_flag="${first_run_flag}" found="${found_flag}" person_info="${person_info}"/>
            </Sequence>
            <Sequence>
                <IsHumanFoundCondition ID="isHumanFound" found_flag="${found_flag}"/>
                <SubTree ID="NavigationWithRecovery"/>
                <FindSameHumanAction ID="findSameHuman" current_id="${current_id}" found="${found_flag}" person_info="${person_info}"/>
            </Sequence>
            <Sequence>
                <Fallback>
                    <HasMovedCondition ID="hasMovedToLastPosition" moved_flag="${moved_flag}"/>
                    <Sequence name="">
                        <SubTree ID="NavigationWithRecovery"/>
                        <SetBlackboard name="" output_key="${moved_flag}" value="true"/>
                    </Sequence>
                </Fallback>
                <FindSameHumanAction ID="findSameHuman" current_id="${current_id}" found="${found_flag}" person_info="${person_info}"/>
            </Sequence>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="NavigationWithRecovery">
	    <RecoveryNode number_of_retries="6" name="NavigateRecovery">
	      <PipelineSequence name="NavigateWithReplanning">
		<RateController hz="1.0">
		  <RecoveryNode number_of_retries="1" name="ComputePathToPose">
		    <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>
		    <ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
		  </RecoveryNode>
		</RateController>
		<RecoveryNode number_of_retries="1" name="FollowPath">
		  <FollowPath path="{path}" controller_id="FollowPath"/>
		  <ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
		</RecoveryNode>
	      </PipelineSequence>
	      <ReactiveFallback name="RecoveryFallback">
		<GoalUpdated/>
		<SequenceStar name="RecoveryActions">
		  <ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
		  <ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
		  <Spin spin_dist="1.57"/>
		  <Wait wait_duration="5"/>
		</SequenceStar>
	      </ReactiveFallback>
	    </RecoveryNode>
    </BehaviorTree>
</root>

