<?xml version="1.0"?>
<root main_tree_to_execute="BehaviorTree">
	<!-- ////////// -->
	<BehaviorTree ID="BehaviorTree">
		<Repeat num_cycles="9999999">
			<Fallback>

				<!-- init -->
				<Sequence>
					<IsFirstRun ID="isFirstRun" current_id="{current_id}" found="{found}" moved_flag="{moved_flag}" person_info="{person_info}" />
					<RateController hz="1.0">
						<FindHuman ID="findHuman" current_id="{current_id}" first_run_flag="{first_run_flag}" found="{found}" person_info="{person_info}" goal="{goal}"/>
					</RateController>
				</Sequence>

				<!-- main loop -->
				<Sequence>
					<IsHumanFound ID="isHumanFound" found="{found}"/>
					<RecoveryNode number_of_retries="6" name="NavigateRecovery">
						<PipelineSequence name="NavigateWithReplanning">
							<RateController hz="1.0">
								<RecoveryNode number_of_retries="1" name="ComputePathToPose">
									<ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>
									<ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
								</RecoveryNode>
							</RateController>
							<RecoveryNode number_of_retries="1" name="FollowPath">
								<FollowPath path="{path}" controller_id="FollowPath"/>
								<ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
							</RecoveryNode>
						</PipelineSequence>
						<ReactiveFallback name="RecoveryFallback">
							<GoalUpdated/>
							<SequenceStar name="RecoveryActions">
								<ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
								<ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
								<Spin spin_dist="1.57"/>
								<Wait wait_duration="5"/>
							</SequenceStar>
						</ReactiveFallback>
					</RecoveryNode>
					<RateController hz="1.0">
						<FindSameHuman ID="findSameHuman" current_id="{current_id}" found="{found}" person_info="{person_info}"/>
					</RateController>
				</Sequence>

				<!-- recovery -->
				<Sequence>
					<Fallback>
						<HasMoved ID="hasMovedToLastPosition" moved_flag="{moved_flag}"/>
						<Sequence name="">
							<RecoveryNode number_of_retries="6" name="NavigateRecovery">
								<PipelineSequence name="NavigateWithReplanning">
									<RateController hz="1.0">
										<RecoveryNode number_of_retries="1" name="ComputePathToPose">
											<ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>
											<ClearEntireCostmap name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
										</RecoveryNode>
									</RateController>
									<RecoveryNode number_of_retries="1" name="FollowPath">
										<FollowPath path="{path}" controller_id="FollowPath"/>
										<ClearEntireCostmap name="ClearLocalCostmap-Context" service_name="local_costmap/clear_entirely_local_costmap"/>
									</RecoveryNode>
								</PipelineSequence>
								<ReactiveFallback name="RecoveryFallback">
									<GoalUpdated/>
									<SequenceStar name="RecoveryActions">
										<ClearEntireCostmap name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
										<ClearEntireCostmap name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
										<Spin spin_dist="1.57"/>
										<Wait wait_duration="5"/>
									</SequenceStar>
								</ReactiveFallback>
							</RecoveryNode>
							<SetBlackboard name="" output_key="{moved_flag}" value="true"/>
						</Sequence>
					</Fallback>
					<RateController hz="1.0">
						<FindSameHuman ID="findSameHuman" current_id="{current_id}" found="{found}" person_info="{person_info}"/>
					</RateController>
				</Sequence>

			</Fallback>
		</Repeat>
	</BehaviorTree>
	<!-- ////////// -->
</root>
